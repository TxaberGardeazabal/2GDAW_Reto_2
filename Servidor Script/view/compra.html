<!DOCTYPE html>
<html lang="en" style="margin: 0%;padding: 0%;">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="javascript/bootstrap.bundle.min.js"></script>
    <script src="javascript/jquery-3.6.0.min.js"></script>
    <script src="javascript/sweetalert2.all.js"></script>
    <link rel="stylesheet" href="css/sweetalert2.css">
</head>
<body>
    <h2 id="titulo" style="padding: 2.5% 0;"><b>Tu Carrito</b></h2>
    <table id="tablaResultado" style="width: 92%;">
        <thead>
          <tr style="color:gray">
            <td style="background-color: rgb(245, 245, 245);padding: 2% 0;width: 6%;"></td>
            <td style="background-color: rgb(245, 245, 245);padding: 2% 0;width: 6%;"></td>
            <td style="background-color: rgb(245, 245, 245);padding: 2% 0;width: 25%;"><b>PRODUCTO</b></td>
            <td style="padding: 2% 0;width: 6%;"></td>
            <td style="border-bottom: 0.7px solid rgb(211, 211, 211);margin: 2%;padding: 2% 0;width: 15%;"><b>PRECIO</b></td>
            <td style="border-bottom: 0.7px solid rgb(211, 211, 211);padding: 2% 0;width: 20%;"><b>CANTIDAD</b></td>
            <td style="border-bottom: 0.7px solid rgb(211, 211, 211);padding: 2% 0;width: 10%;"><b>TOTAL</b></td>
          </tr>
        </thead>
        <tbody id="tablaCompra">
            <script>
                $(document).ready(function(){
                    $.getJSON("javascript/carritoCompra.json",function(data){//Datos Obtenidos de las cookies-Sesion 
                        var precioFinal=0;
                        $.each(data.productos, function(i, f) {
                            console.log(i);
                            var fila = "<tr id='"+ i +"'>" + "<td style='background-color: rgb(245, 245, 245);'></td><td style='background-color: rgb(245, 245, 245);padding: 2% 0;'><img class='img-fluid' style='width: 4.2rem'src='imagenes/iphone13.jpg'></td><td style='background-color: rgb(245, 245, 245);padding: 2% 0;'><b>" + f.nombre + "</b><br>" + f.descripcion + "</td>" + "<td></td>" +
                           "<td style='padding: 2% 0;border-bottom: 0.7px solid rgb(211, 211, 211);'><b>" + f.precio + " €</b></td>" + "<td style='padding: 2% 0;border-bottom: 0.7px solid rgb(211, 211, 211);'><input type='number' value='1' min='1'></td>" + "<td style='padding: 2% 0;border-bottom: 0.7px solid rgb(211, 211, 211);'><button id='delete" + i + "' type='button' class='btn btn-outline-danger'>Eliminar</button>" + "</td>" + "</tr>"
                            $(fila).appendTo("#tablaCompra");
                            precioFinal=precioFinal+f.precio;
                            $('#titulo').html("Tu Carrito tiene " + (i+1) + " productos");
                        });

                            $(".btn-outline-danger").click(function(){
                                var id=this.id;
                                var valor=id.length;
                                var borrarId=id.slice(6,valor);
                                console.log("Eliminar " + borrarId);
                            Swal.fire({
                                title: '¿Borrar el producto?',
                                text: "Se borrará el producto del carrito de la compra",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Borrar Producto',
                                cancelButtonText: 'Cancelar',
                                }).then((result) => {
                                if (result.isConfirmed) {
                                    $("#" + borrarId).remove();
                                    //Recargar la pagina
                                    Swal.fire(
                                    'Producto Borrado',
                                    'El producto ha sido borrado del carrito de la compra',
                                    'success'
                                    )
                                }
                            });
                        
                            });


                            //Confirmar compra
                            $('#comprar').click(function(){
                                Swal.fire({
                                title: '¿Confirmar Compra?',
                                text: "Se procederá a el pago de los productos seleccionados",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Comprar',
                                cancelButtonText: 'Cancelar',
                                }).then((result) => {
                                if (result.isConfirmed) {
                                    //Se confirma la compra del producto.
                                    alert("Completar el proceso de la compra de prodictos");
                                }
                            });
                            });     
               
                        var precioFinal="<table style='width:100%'><thead><tr>" + "<td style='padding: 0% 5% 0 0'>SUBTOTAL</td>"+"<td style='text-align:right;'><b>" + precioFinal+  " €</b></td>" + "</tr></thead></table>";
                        $(precioFinal).appendTo("#subtotal");
                    });
                 
                });
            </script>
        </tbody>
    </table>

    <div style="width: 100%;height: 25vh;background-color: rgb(63, 63, 63);bottom: 0%;">
        <table style="width: 92%; margin-bottom: 1%;">
            <thead>
                <tr style="color:gray">
                  <td style="padding: 2% 0;width: 6%;"></td>
                  <td style="padding: 2% 0;width: 4%;"></td>
                  <td style="width: 0%;"><b></b></td>
                  <td style="padding: 2% 0;width: 0%;"></td>
                  <td style="margin: 2%;padding: 2% 0;width: 0%;"><b></b></td>
                  <td id="subtotal" style="border-bottom: 2px solid rgb(211, 211, 211);padding: 2% 0 0 0;width: 2%;color: white;font-size: 150%;padding-bottom: 1%;"></td>
                </tr>
              </thead>
        </table>
        <button id="seguirComprando" type="button" class="btn btn-outline-primary" style="margin-left: 2.5%;margin-right:8.2%;float: right;width: 20%;" onclick="window.location.replace('../../view/index.php')">Seguir Comprando</button><br><br>
        <button id="comprar" type="button" class="btn btn-outline-light" style="margin-left: 2.5%;margin-right:8.2%;float: right;width: 20%;">Comprar</button>
    </div>

    
      
</body>
</html>